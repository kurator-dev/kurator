name: e2e

on:
  workflow_dispatch:
  pull_request:
    branches:
      - main
  push:
    branches:
      - main

permissions:
  contents: read

jobs:
  e2e-test:
    runs-on: ubuntu-22.04
    name: E2E Test
    timeout-minutes: 40
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Build Clusters
        uses: helm/kind-action@v1.8.0
        with:
          version: v0.18.0
          install_only: true
        run: |
          hack/local-dev-setup.sh
      - name: Install Helm
        uses: azure/setup-helm@v3
        with:
          version: v3.10.1
      - name: Init kurator cluster
        run: |
          test/install.sh
      - name: fleet-clusters e2e test
        run: |
          test/fleet-clusters/e2e-run.sh
